<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Çµ„Ç§„Ç≥„É≠„Çø„Éñ„Çµ„Ç§„Éà</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1000px;
            margin: 0 auto;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 2em;
        }

        .login-btn {
            padding: 10px 25px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }

        .login-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .content {
            padding: 40px;
            min-height: 500px;
        }

        /* „É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏ */
        .login-page {
            text-align: center;
            padding: 60px 20px;
        }

        .login-page h2 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .login-page input {
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #667eea;
            border-radius: 10px;
            width: 100%;
            max-width: 400px;
            margin-bottom: 20px;
        }

        .login-page button {
            padding: 15px 40px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 0 10px;
            transition: transform 0.2s;
        }

        .login-page button:hover {
            transform: scale(1.05);
        }

        .login-page .cancel-btn {
            background: #6c757d;
        }

        /* „Éõ„Éº„É†ÁîªÈù¢ */
        .tabs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .tab-button {
            padding: 50px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.5em;
            font-weight: bold;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .tab-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.5);
        }

        /* Âõ∫ÂÆö„Çµ„Ç§„Ç≥„É≠„Ç®„É™„Ç¢ */
        .dice-fixed {
            position: sticky;
            top: 0;
            background: white;
            z-index: 100;
            padding: 30px;
            border-bottom: 3px solid #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .back-button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin-bottom: 20px;
        }

        .back-button:hover {
            background: #5568d3;
        }

        .dice-results {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .dice {
            width: 100px;
            height: 100px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            font-weight: bold;
            color: #667eea;
            transition: transform 0.5s;
        }

        .dice.rolling {
            animation: roll 0.5s ease-in-out;
        }

        @keyframes roll {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
        }

        .dice-labels {
            text-align: center;
            font-size: 1.3em;
            color: #667eea;
            font-weight: bold;
            margin-top: 15px;
        }

        .roll-button {
            padding: 15px 40px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        .roll-button:hover {
            transform: scale(1.05);
        }

        /* „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
        .tab-content {
            padding: 30px;
            font-size: 1.1em;
            line-height: 1.8;
            color: #333;
        }

        /* „Éõ„Çπ„Éà„Ç≥„É≥„Éà„É≠„Éº„É´ */
        .host-controls {
            margin: 30px;
            padding: 25px;
            background: #fff3cd;
            border-radius: 10px;
            border: 2px solid #ffc107;
        }

        .host-controls h3 {
            color: #856404;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .host-controls label {
            display: block;
            margin: 15px 0 5px 0;
            color: #856404;
            font-weight: bold;
        }

        .host-controls input, .host-controls textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ffc107;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 10px;
            font-family: inherit;
        }

        .host-controls textarea {
            min-height: 150px;
            resize: vertical;
        }

        .host-controls button {
            padding: 12px 30px;
            background: #ffc107;
            color: #856404;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 10px 10px 0 0;
        }

        .host-controls button:hover {
            background: #e0a800;
        }

        .host-controls .danger-btn {
            background: #dc3545;
            color: white;
        }

        .host-controls .danger-btn:hover {
            background: #c82333;
        }

        .dice-log {
            max-height: 400px;
            overflow-y: auto;
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .log-entry {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            font-size: 0.9em;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé≤ „Çµ„Ç§„Ç≥„É≠„Çø„Éñ„Çµ„Ç§„Éà</h1>
            <button class="login-btn" onclick="showLoginPage()">üîë „É≠„Ç∞„Ç§„É≥</button>
        </div>

        <div class="content">
            <!-- „É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏ -->
            <div id="loginPage" class="login-page hidden">
                <h2>„Éõ„Çπ„Éà„É≠„Ç∞„Ç§„É≥</h2>
                <input type="password" id="hostIdInput" placeholder="„Éõ„Çπ„ÉàID">
                <br>
                <button onclick="login()">„É≠„Ç∞„Ç§„É≥</button>
                <button class="cancel-btn" onclick="cancelLogin()">„Ç≠„É£„É≥„Çª„É´</button>
            </div>

            <!-- „Éõ„Éº„É†ÁîªÈù¢ -->
            <div id="homePage">
                <div class="tabs-grid" id="tabsGrid">
                    <!-- „Çø„Éñ„Éú„Çø„É≥„ÅåÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                </div>

                <!-- „Éõ„Çπ„ÉàË®≠ÂÆö - „Éõ„Éº„É† -->
                <div id="hostHomeControls" class="host-controls hidden">
                    <h3>üîß „Éõ„Éº„É†Ë®≠ÂÆö</h3>
                    <button onclick="addNewTab()">‚ûï Êñ∞„Åó„ÅÑ„Çø„Éñ„ÇíËøΩÂä†</button>
                    <button onclick="saveAllSettings()">üíæ „Åô„Åπ„Å¶„ÅÆË®≠ÂÆö„Çí‰øùÂ≠ò</button>
                </div>
            </div>

            <!-- „Çø„Éñ„Éö„Éº„Ç∏ -->
            <div id="tabPage" class="hidden">
                <div class="dice-fixed">
                    <button class="back-button" onclick="goHome()">‚Üê „Éõ„Éº„É†„Å´Êàª„Çã</button>
                    <h2 id="currentTabTitle" style="color: #667eea; margin-bottom: 20px;"></h2>
                    <div class="dice-results" id="diceContainer"></div>
                    <div class="dice-labels" id="diceLabels"></div>
                    <button class="roll-button" onclick="rollAllDice()">üé≤ „É≠„Éº„É´</button>
                </div>

                <div class="tab-content" id="tabContentText"></div>

                <!-- „Éõ„Çπ„ÉàË®≠ÂÆö - „Çø„Éñ -->
                <div id="hostTabControls" class="host-controls hidden">
                    <h3>üîß „Çø„ÉñË®≠ÂÆö</h3>
                    
                    <label>„Çø„Éñ„Çø„Ç§„Éà„É´:</label>
                    <input type="text" id="editTabTitle">
                    
                    <label>„Çø„ÉñÂÜÖÂÆπ:</label>
                    <textarea id="editTabContent" placeholder="„Çø„Éñ„ÅÆË™¨Êòé„ÇÑÂÜÖÂÆπ„ÇíÂÖ•Âäõ..."></textarea>
                    
                    <label>„Çµ„Ç§„Ç≥„É≠„ÅÆÊï∞:</label>
                    <input type="number" id="editDiceCount" value="2" min="1" max="10">
                    
                    <label>„Çµ„Ç§„Ç≥„É≠„ÅÆÁØÑÂõ≤ÔºàÊúÄÂ∞èÔºâ:</label>
                    <input type="number" id="editDiceMin" value="1" min="0">
                    
                    <label>„Çµ„Ç§„Ç≥„É≠„ÅÆÁØÑÂõ≤ÔºàÊúÄÂ§ßÔºâ:</label>
                    <input type="number" id="editDiceMax" value="6" min="1">
                    
                    <label>„Çµ„Ç§„Ç≥„É≠„ÅÆ„É©„Éô„É´Ôºà„Ç´„É≥„ÉûÂå∫Âàá„Çä„ÄÅ‰æã: w,x,y,zÔºâ:</label>
                    <input type="text" id="editDiceLabels" value="w,x">
                    
                    <button onclick="applyTabSettings()">Ë®≠ÂÆö„ÇíÈÅ©Áî®</button>
                    <button class="danger-btn" onclick="deleteTab()">üóëÔ∏è „Åì„ÅÆ„Çø„Éñ„ÇíÂâäÈô§</button>
                    
                    <h3 style="margin-top: 30px;">üìä „Çµ„Ç§„Ç≥„É≠„ÅÆË®òÈå≤</h3>
                    <div class="dice-log" id="diceLog"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isHost = false;
        let currentTabId = null;
        
        // „Çø„Éñ„Éá„Éº„Çø
        let tabs = [
            { id: 1, title: 'ÈÅãË©¶„Åó„Çµ„Ç§„Ç≥„É≠', content: '', diceCount: 2, diceMin: 1, diceMax: 6, labels: ['w', 'x'], logs: [] },
            { id: 2, title: 'Ê±∫Êñ≠„Çµ„Ç§„Ç≥„É≠', content: '', diceCount: 2, diceMin: 1, diceMax: 6, labels: ['w', 'x'], logs: [] },
            { id: 3, title: '„ÉÅ„É£„É¨„É≥„Ç∏„Çµ„Ç§„Ç≥„É≠', content: '', diceCount: 2, diceMin: 1, diceMax: 6, labels: ['w', 'x'], logs: [] }
        ];
        let nextTabId = 4;

        // ÂàùÊúüÂåñ
        renderTabs();

        function showLoginPage() {
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
        }

        function cancelLogin() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('homePage').classList.remove('hidden');
            document.getElementById('hostIdInput').value = '';
        }

        function login() {
            const hostId = document.getElementById('hostIdInput').value.trim();
            
            if (hostId === 'yakumo') {
                isHost = true;
                document.getElementById('hostHomeControls').classList.remove('hidden');
                alert('„Éõ„Çπ„Éà„É¢„Éº„Éâ„Åß„É≠„Ç∞„Ç§„É≥„Åó„Åæ„Åó„ÅüÔºÅ');
                cancelLogin();
            } else {
                alert('ID„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì');
            }
        }

        function renderTabs() {
            const grid = document.getElementById('tabsGrid');
            grid.innerHTML = '';
            
            tabs.forEach(tab => {
                const button = document.createElement('button');
                button.className = 'tab-button';
                button.innerHTML = `<div>üé≤</div><div>${tab.title}</div>`;
                button.onclick = () => openTab(tab.id);
                grid.appendChild(button);
            });
        }

        function openTab(tabId) {
            currentTabId = tabId;
            const tab = tabs.find(t => t.id === tabId);
            
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('tabPage').classList.remove('hidden');
            document.getElementById('currentTabTitle').textContent = tab.title;
            document.getElementById('tabContentText').textContent = tab.content;
            
            if (isHost) {
                document.getElementById('hostTabControls').classList.remove('hidden');
                document.getElementById('editTabTitle').value = tab.title;
                document.getElementById('editTabContent').value = tab.content;
                document.getElementById('editDiceCount').value = tab.diceCount;
                document.getElementById('editDiceMin').value = tab.diceMin;
                document.getElementById('editDiceMax').value = tab.diceMax;
                document.getElementById('editDiceLabels').value = tab.labels.join(',');
                renderDiceLog(tab);
            }
            
            initializeDice();
            rollAllDice();
        }

        function goHome() {
            document.getElementById('tabPage').classList.add('hidden');
            document.getElementById('homePage').classList.remove('hidden');
            currentTabId = null;
        }

        function initializeDice() {
            const tab = tabs.find(t => t.id === currentTabId);
            const container = document.getElementById('diceContainer');
            container.innerHTML = '';
            
            for (let i = 0; i < tab.diceCount; i++) {
                const dice = document.createElement('div');
                dice.className = 'dice';
                dice.id = 'dice_' + i;
                dice.textContent = '?';
                container.appendChild(dice);
            }
        }

        function rollAllDice() {
            const tab = tabs.find(t => t.id === currentTabId);
            const results = [];
            
            for (let i = 0; i < tab.diceCount; i++) {
                const dice = document.getElementById('dice_' + i);
                dice.classList.add('rolling');
                
                setTimeout(() => {
                    const result = Math.floor(Math.random() * (tab.diceMax - tab.diceMin + 1)) + tab.diceMin;
                    dice.textContent = result;
                    dice.classList.remove('rolling');
                    results.push(result);
                    
                    if (i === tab.diceCount - 1) {
                        updateDiceLabels(results);
                        logDiceRoll(results);
                    }
                }, 500);
            }
        }

        function updateDiceLabels(results) {
            const tab = tabs.find(t => t.id === currentTabId);
            const labelsDiv = document.getElementById('diceLabels');
            const labelParts = [];
            
            for (let i = 0; i < results.length; i++) {
                const label = tab.labels[i] || String.fromCharCode(119 + i); // w, x, y, z...
                labelParts.push(`${label}:${results[i]}`);
            }
            
            labelsDiv.textContent = labelParts.join(' ');
        }

        function logDiceRoll(results) {
            const tab = tabs.find(t => t.id === currentTabId);
            const timestamp = new Date().toLocaleString('ja-JP');
            const ip = '192.168.1.' + Math.floor(Math.random() * 255); // Ê®°Êì¨IP
            
            const logEntry = {
                timestamp,
                ip,
                results: [...results]
            };
            
            tab.logs.unshift(logEntry);
            if (tab.logs.length > 100) tab.logs.pop(); // ÊúÄÂ§ß100‰ª∂
            
            if (isHost) {
                renderDiceLog(tab);
            }
        }

        function renderDiceLog(tab) {
            const logDiv = document.getElementById('diceLog');
            logDiv.innerHTML = '';
            
            if (tab.logs.length === 0) {
                logDiv.innerHTML = '<p style="color: #999;">„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }
            
            tab.logs.forEach(log => {
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                const resultLabels = log.results.map((r, i) => {
                    const label = tab.labels[i] || String.fromCharCode(119 + i);
                    return `${label}:${r}`;
                }).join(' ');
                entry.innerHTML = `
                    <strong>${log.timestamp}</strong><br>
                    IP: ${log.ip}<br>
                    ÁµêÊûú: ${resultLabels}
                `;
                logDiv.appendChild(entry);
            });
        }

        function applyTabSettings() {
            const tab = tabs.find(t => t.id === currentTabId);
            
            tab.title = document.getElementById('editTabTitle').value;
            tab.content = document.getElementById('editTabContent').value;
            tab.diceCount = parseInt(document.getElementById('editDiceCount').value);
            tab.diceMin = parseInt(document.getElementById('editDiceMin').value);
            tab.diceMax = parseInt(document.getElementById('editDiceMax').value);
            
            const labelsInput = document.getElementById('editDiceLabels').value;
            tab.labels = labelsInput.split(',').map(l => l.trim()).filter(l => l);
            
            document.getElementById('currentTabTitle').textContent = tab.title;
            document.getElementById('tabContentText').textContent = tab.content;
            
            initializeDice();
            rollAllDice();
            renderTabs();
        }

        function addNewTab() {
            const title = prompt('Êñ∞„Åó„ÅÑ„Çø„Éñ„ÅÆ„Çø„Ç§„Éà„É´„ÇíÂÖ•Âäõ:');
            if (!title) return;
            
            tabs.push({
                id: nextTabId++,
                title: title,
                content: '',
                diceCount: 2,
                diceMin: 1,
                diceMax: 6,
                labels: ['w', 'x'],
                logs: []
            });
            
            renderTabs();
        }

        function deleteTab() {
            if (!confirm('„Åì„ÅÆ„Çø„Éñ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
            
            tabs = tabs.filter(t => t.id !== currentTabId);
            renderTabs();
            goHome();
        }

        function saveAllSettings() {
            const data = JSON.stringify(tabs);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dice-tabs-settings.json';
            a.click();
            alert('Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
        }
    </script>
</body>
</html>
